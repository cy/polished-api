<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>REST API with Flask/Python</title>

		<meta name="description" content="A presentation to the Women in Tech meetup group">
		<meta name="author" content="Christine Yu">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/solarized.css" id="theme">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Building a REST API with Flask and Python</h1>
					<p>
            <i class="fa fa-github"></i> <a href="https://github.com/cy">github.com/cy</a><br />
            <i class="fa fa-twitter"></i> <a href="http://twitter.com/christinewhy">@christinewhy</a>
					</p>
				</section>

				<section>
          <section>
            <h2>Goal</h2>
            <p>Quickly create a deployed REST API and a basic front end app to consume.</p>
          </section>
          <section>
          <h2>Result</h2>
            <p>
            <table>
              <tr>
                <td><img src="imgs/http-screenshot.png" style="height: 300px"></td>
                <td><img src="https://github.com/cy/polished-mobile/raw/master/screenshot.png" style="height: 300px"></td>
              </tr>
              <tr>
                <td halign="center">4h</td>
                <td halign="center">1h</td>
              </tr>
            </table>
          </p>
          </section>
          <section data-markdown>
            How?
            =========
            - REST: well defined architecture style
            - Python/Flask: micro webframe work
            - Heroku: free 1 dyno deployments using git + CLI tool
            - Ionic/Angular/Cardova: quickly create a mobile app
          </section>
				</section>

				<section>
					<section>
						<h2>REST</h2>
            <p>
              <img src="imgs/rest.png" style="height: 400px">
              <small>source: http://www.slideshare.net/Solution4Future/python-restful-webservices-with-python-flask-and-django-solutions</small>
            </p>
					</section>
					<section data-markdown>
						REST over SOAP?
            ---------------
            - simple, well defined routes
              -no need for Web Service Definition Language
            - typically JSON, but format agnostic
              - example api returns xml or json based on Accept header
					</section>
				</section>

        <section>
          <section>
					<h2>Flask</h2>
					<p>
            <img src="http://imgs.xkcd.com/comics/python.png" style="height: 400px">
            <small>
              <ul>
                <li>a Python micro-framework, like Django but distilled down</li>
                <li>core is light</li>
                  <ul>
                    <li>no admin interface, migrations, manage.py</li>
                    <li>http://flask.pocoo.org/extensions/</li>
                  </ul>
              </ul>
            </small>
					</p>
          </section>
          <section data-markdown>
            ```Python
            from flask import Flask
            app = Flask(__name__)

            @app.route("/")
            def hello():
                return "Hello World!"

                if __name__ == "__main__":
                    app.run()
            ```
          </section>
          <section>
            <h3>Routing</h3>
            <ul>
              <li>match a URL with HTTP method(s) and handler</li>
              <li>returns a HTTP response and status code</li>
            </ul>
          </section>
          <section>
            <h3>Decorators</h3>
            <ul>
              <li>a function that creates a wrapper around another function</li>
              <li>returns a new function that is the same as before but with extra processing</li>
            </ul>
          </section>
          <section>
            <h3>Routing with Decorators!</h3>
            <ul>
              <li>the @route() decorator binds a function to an URL</li>
              <li>simplier than <a href="https://docs.djangoproject.com/en/1.8/topics/http/urls/">Django</a>, <a href="http://guides.rubyonrails.org/routing.html">Rails</a></li>
              <li>similar to <a href="http://expressjs.com/guide/routing.html">Express</a> (uses callbacks)</li>
            </ul>
          </section>
				</section>
				
				<section>
					<h2>The code!</h2>
          <small><a href="https://github.com/cy/polished-api/">https://github.com/cy/polished-api/</a></small>
					<pre><code data-trim contenteditable>
import os
from flask import Flask, jsonify, Response, abort, request, make_response

import json
from functools import wraps
import dicttoxml
import xml.dom.minidom as minidom

from flask.ext.cors import cross_origin, CORS

app = Flask(__name__)
cors = CORS(app, resources={r"/manicures/*": {"origins": "*"}})

manicures = [
        {
            'id': 1,
            'polishes': [{'brand': 'essie', 'name': 'mint candy apple', 'colors': ['#A4D9D0']}],
            'photo': '/static/1.jpg',
            'name': 'Slightly Chipped Mint Candy Apple',
        },
        {
            'id': 2,
            'polishes': [
                    {'brand': 'deborah lippmann', 'name': 'when lightning strikes', 'colors': ['#FFFFFF', '#999EA0']},
                    {'brand': 'opi', 'name': 'give me the moon', 'colors': ['#cfc7dd']},
            ],
            'photo': '/static/2.jpg',
            'name': 'Moon Lightning'
        }
    ]

def select_response_format(func):
    """
        Decorator that responds with either XML or JSON (default) depending on Accept header.
    """
    @wraps(func)
    def wrapper(*args, **kwargs):
        data = func(*args, **kwargs)
        mimetype = request.headers.get('Accept', '*/*')
        if "xml" in mimetype:
            data = dicttoxml.dicttoxml(data, attr_type=False, root=False)
        else:
            data = json.dumps(data)
            mimetype = "application/json"

        return Response(data, mimetype=mimetype)
    return wrapper


@app.route('/manicures', methods=['GET'])
@cross_origin()
@select_response_format
def get_manicures():
    return {'manicures': manicures }


@app.route('/manicures/<int:manicure_id>', methods=['GET'])
@cross_origin()
@select_response_format
def get_manicure(manicure_id):
    for m in manicures:
        if m['id'] == manicure_id:
            return { 'manicure': m }
    abort(404)


@app.route('/manicures', methods=['POST'])
@select_response_format
def create_manicure():
    #pdb.set_trace()
    if not request.json or not 'name' in request.json:
        abort(400)
    manicure = {
                'id': manicures[-1]['id'] + 1,
                'name': request.json['name'],
                'polishes': request.json.get('polishes', []),
                'photo': request.json.get('photo', '')
                }
    manicures.append(manicure)
    print manicures
    return {'manicure': manicure}


@app.route('/manicures/<int:manicure_id>', methods=['PUT'])
@select_response_format
def update_manicure(manicure_id):
    for m in manicures:
        if m['id'] == manicure_id:
            m['name'] = request.json.get('name', m['name'])
            m['polishes'] = request.json.get('polishes', m['polishes'])
            m['photo'] = request.json.get('photo', m['photo'])
            return { 'manicure': m }

    abort(400)


@app.route('/manicures/<int:manicure_id>', methods=['DELETE'])
@select_response_format
def delete_manicure(manicure_id):
    for m in manicures:
        if m['id'] == manicure_id:
            manicures.remove(m)
            return { 'result': 'deleted' }

    abort(400)


@app.errorhandler(404)
def not_found(error):
    return make_response(jsonify({'error': 'Not found'}), 404)


if __name__ == '__main__':
    port = int(os.environ.get("PORT", 5000))
    app.run(host='0.0.0.0', port=port)
					</code></pre>
				</section>

				<section>
          <h1>Demo</h1>
        </section>

        <section data-markdown>
        Todos
        ------------
        - Persist the data (SQLAlchemy, MongoDB)
        - Authentication (https://github.com/miguelgrinberg/Flask-HTTPAuth)
        - Actually upload image files (http://flask.pocoo.org/docs/0.10/patterns/fileuploads/)
        - Validate user input
        - tests (https://pypi.python.org/pypi/pytest-flask)
				</section>
					
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'convex', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
